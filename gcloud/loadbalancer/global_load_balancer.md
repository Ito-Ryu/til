# Google Cloud グローバルロードバランサ (Global Load Balancing) 徹底解説

Google Cloud のグローバルロードバランサは、単一の Anycast IP アドレスを使用して、世界中のユーザーからのトラフィックを最も近いリージョンのバックエンドに効率的に分散します。低遅延、高可用性、および大規模なスケーラビリティを提供します。

参照元: [Google Cloud Load Balancing Documentation](https://cloud.google.com/load-balancing/docs/external)

---

## 1. ロードバランサの主要な分類 (L4 vs L7)

| 特徴 | グローバル外部プロキシ (Network) | グローバル外部アプリケーション (Application) |
| :--- | :--- | :--- |
| **タイプ** | プロキシ型 (Envoy ベース) | プロキシ型 (Envoy ベース) |
| **プロトコル** | TCP, SSL (TLS) | HTTP, HTTPS, HTTP/2, gRPC |
| **SSL 終端** | 可能 (ロードバランサで処理) | 可能 (ロードバランサで処理) |
| **送信元 IP** | プロキシの IP に変更される (Client IP は外部ヘッダー等で保持) | プロキシの IP に変更される (X-Forwarded-For 等で保持) |
| **主な特徴** | 世界規模の L4 負荷分散、SSL オフロード | 高度な L7 ルーティング、CDN 統合、WAF 保護 |

---

## 2. 各ロードバランサの詳細

### Global External Application Load Balancer (L7)
*   **動作原理:** Google のエッジロケーションでトラフィックを終端し、最適なリージョンのバックエンドへルーティングします。
*   **メリット:** URL パスベースのルーティング、ホストベースのルーティング、リライト、ヘッダー修正などが可能です。
*   **統合サービス:** 
    *   **Cloud CDN:** 静的コンテンツのキャッシュをエッジで提供。
    *   **Google Cloud Armor:** DDoS 対策および WAF 機能による保護。
    *   **Identity-Aware Proxy (IAP):** アプリケーション層での認証・認可。

### Global External Proxy Network Load Balancer (L4)
*   **動作原理:** TCP または SSL トラフィックを Google のエッジで終端し、バックエンドへ転送します。
*   **メリット:** 非 HTTP プロトコル（ゲーム、データベース等）のグローバルな負荷分散に適しています。バックエンドでの SSL 処理をオフロードできます。
*   **注意点:** 従来の「SSL プロキシ」および「TCP プロキシ」ロードバランサを統合した名称です。

---

## 3. Anycast IP とエッジロケーション

グローバルロードバランサの最大の特徴は、**Anycast IP アドレス**の使用です。

*   **単一の IP:** 世界中どこからアクセスしても同じ IP アドレスを使用できます。
*   **エッジでの終端:** ユーザーのトラフィックは、地理的に最も近い Google のエッジロケーション（PoP）で受信されます。
*   **プレミアムティア:** グローバル負荷分散を利用するには、ネットワークサービスティアで「プレミアムティア」を選択する必要があります。

---

## 4. ヘルスチェック (Health Checks)

バックエンドの健全性を監視し、正常なインスタンスにのみトラフィックを送信します。

*   **分散型監視:** 世界中の複数のプローバーからバックエンドに対してヘルスチェックが行われます。
*   **送信元 IP:** Google Cloud のヘルスチェックシステム (`35.191.0.0/16`, `130.211.0.0/22`) から送信されます。
*   **ファイアウォール:** バックエンド VM のファイアウォールルールで、上記 IP 範囲からの通信を許可する必要があります。

---

## まとめ: 選択のポイント
1.  **HTTP/HTTPS 通信であり、高度なルーティングや CDN、WAF が必要** → **グローバル外部アプリケーション**
2.  **TCP/SSL 通信（HTTP 以外）であり、世界規模での負荷分散と SSL オフロードが必要** → **グローバル外部プロキシ**
3.  **特定のリージョン内に限定した露出で十分であり、低コストを優先したい** → **リージョン外部ロードバランサ（別途検討）**
